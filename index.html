<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–Ω–ª–∞–π–Ω-—Ç–µ—Å—Ç –û–ó–ü</title>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 800px;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        /* –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù */
        #start-screen {
            text-align: center;
        }

        .welcome-text {
            color: #5d6d7e;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        #class-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        #class-selection button {
            padding: 20px;
            font-size: 1.2em;
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        #class-selection button:hover {
            transform: translateY(-5px);
        }

        .loading {
            text-align: center;
            color: #667eea;
            font-size: 1.2em;
            padding: 20px;
        }

        .error-message {
            color: #e74c3c;
            text-align: center;
            padding: 20px;
            background: #ffeaea;
            border-radius: 10px;
            margin: 20px 0;
        }

        /* –≠–ö–†–ê–ù –¢–ï–°–¢–ê */
        #quiz-container {
            display: none;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        #progress-counter {
            font-weight: bold;
            color: #667eea;
        }

        #navigation-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .nav-dot {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid #ddd;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-dot.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .nav-dot.answered {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .question-area {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        #question-text {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #2c3e50;
            line-height: 1.5;
        }

        .answer-option {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            line-height: 1.4;
        }

        .answer-option:hover {
            border-color: #667eea;
            background: #f0f2ff;
            transform: translateX(5px);
        }

        .answer-option.selected {
            border-color: #667eea;
            background: #e0e7ff;
            font-weight: bold;
        }

        /* –ö–û–ù–¢–ï–ô–ù–ï–† –ö–ù–û–ü–û–ö */
        .buttons-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            flex-wrap: wrap;
            gap: 10px;
        }

        .buttons-container button {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            min-width: 150px;
        }

        #prev-button {
            background: #6c757d;
            color: white;
        }

        #prev-button:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        #next-button {
            background: #667eea;
            color: white;
        }

        #next-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        #finish-button, #finish-anytime-button {
            background: #10b981;
            color: white;
        }

        #finish-button:hover, #finish-anytime-button:hover {
            background: #0da271;
            transform: translateY(-2px);
        }

        #finish-anytime-button {
            width: 100%;
            margin-top: 15px;
            padding: 15px;
            font-size: 1.1em;
        }

        button:disabled {
            background: #ccc !important;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none !important;
        }

        button:disabled:hover {
            background: #ccc !important;
            transform: none !important;
        }

        /* –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–û–í */
        #results-screen {
            display: none;
            text-align: center;
        }

        #score {
            font-size: 3em;
            color: #667eea;
            font-weight: bold;
            margin: 20px 0;
            display: block;
        }

        .result-item {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #ef4444;
            text-align: left;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .result-item.correct {
            border-left-color: #10b981;
        }

        #restart-button {
            margin-top: 30px;
            padding: 15px 40px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s;
        }

        #restart-button:hover {
            transform: translateY(-3px);
            background: #e68900;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            #class-selection {
                grid-template-columns: 1fr;
            }
            
            .buttons-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .buttons-container button {
                width: 100%;
                min-width: unset;
            }
            
            #finish-anytime-button {
                order: 3;
                margin-top: 10px;
            }
            
            #question-text {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <!-- –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù -->
        <div id="start-screen">
            <h2>üé® –û–Ω–ª–∞–π–Ω-—Ç–µ—Å—Ç –ø–æ –û—Å–Ω–æ–≤–∞–º –ó–∞—â–∏—Ç—ã –ü—Ä–æ–µ–∫—Ç–æ–≤</h2>
            <div class="welcome-text">
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∫–ª–∞—Å—Å –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                <p>–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–Ω–∞–Ω–∏—è –ø–æ –æ—Å–Ω–æ–≤–∞–º –∏–∑–æ–±—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–∫—É—Å—Å—Ç–≤–∞ –∏ –¥–∏–∑–∞–π–Ω–∞</p>
                <p><strong>–í–æ–ø—Ä–æ—Å—ã –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ</strong></p>
            </div>
            
            <div id="loading" class="loading">
                ‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤...
            </div>
            
            <div id="class-selection" style="display: none;">
                <button data-class="5">5 –∫–ª–∞—Å—Å</button>
                <button data-class="6">6 –∫–ª–∞—Å—Å</button>
                <button data-class="7">7 –∫–ª–∞—Å—Å</button>
                <button data-class="8">8 –∫–ª–∞—Å—Å</button>
                <button data-class="9">9 –∫–ª–∞—Å—Å</button>
            </div>
            
            <div id="error-message" class="error-message" style="display: none;"></div>
        </div>

        <!-- –≠–ö–†–ê–ù –¢–ï–°–¢–ê -->
        <div id="quiz-container">
            <div class="quiz-header">
                <span id="selected-class"></span>
                <span id="progress-counter"></span>
            </div>

            <div id="navigation-panel"></div>

            <div class="question-area">
                <div id="question-text"></div>
                <div id="answers-area"></div>
            </div>

            <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –° –ö–ù–û–ü–ö–ê–ú–ò -->
            <div class="buttons-container">
                <button id="prev-button">‚Üê –ù–∞–∑–∞–¥</button>
                <div style="display: flex; gap: 10px;">
                    <button id="next-button">–î–∞–ª–µ–µ ‚Üí</button>
                    <button id="finish-button" style="display: none;">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                </div>
                <button id="finish-anytime-button" style="display: none;">
                    üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç –¥–æ—Å—Ä–æ—á–Ω–æ
                </button>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–û–í -->
        <div id="results-screen">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h2>
            <p>–í–µ—Ä–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</p>
            <span id="score">0 –∏–∑ 0</span>
            
            <div id="report-container" style="margin: 30px 0;"></div>
            
            <button id="restart-button">üîÑ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ</button>
        </div>

    </div>

    <script>
        // =============================================
        // –ö–û–ù–°–¢–ê–ù–¢–´
        // =============================================
        const QUESTIONS_URL = 'https://raw.githubusercontent.com/mironovka6-source/OZP/main/questions.json';

        // =============================================
        // –≠–õ–ï–ú–ï–ù–¢–´ DOM
        // =============================================
        const startScreen = document.getElementById('start-screen');
        const quizContainer = document.getElementById('quiz-container');
        const resultsScreen = document.getElementById('results-screen');
        const classSelection = document.getElementById('class-selection');
        const loadingElement = document.getElementById('loading');
        const errorMessageElement = document.getElementById('error-message');
        const questionText = document.getElementById('question-text');
        const answersArea = document.getElementById('answers-area');
        const navigationPanel = document.getElementById('navigation-panel');
        const progressCounter = document.getElementById('progress-counter');
        const selectedClassSpan = document.getElementById('selected-class');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const finishButton = document.getElementById('finish-button');
        const finishAnytimeButton = document.getElementById('finish-anytime-button');
        const restartButton = document.getElementById('restart-button');
        const scoreSpan = document.getElementById('score');
        const reportContainer = document.getElementById('report-container');

        // =============================================
        // –ü–ï–†–ï–ú–ï–ù–ù–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø
        // =============================================
        let allQuestions = [];
        let currentClass = null;
        let filteredQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;

        // =============================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // =============================================
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ (–∞–ª–≥–æ—Ä–∏—Ç–º –§–∏—à–µ—Ä–∞-–ô–µ—Ç—Å–∞)
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ
        function shuffleAnswers(answers) {
            // –ù–∞—Ö–æ–¥–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
            const correctIndex = answers.findIndex(a => a.isCorrect);
            if (correctIndex === -1) return answers;
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –º–∞—Å—Å–∏–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
            const shuffledAnswers = [...answers];
            const correctAnswer = shuffledAnswers[correctIndex];
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞
            shuffledAnswers.splice(correctIndex, 1);
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –æ—Ç–≤–µ—Ç—ã
            const shuffledWrongAnswers = shuffleArray(shuffledAnswers);
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            const randomPosition = Math.floor(Math.random() * (shuffledWrongAnswers.length + 1));
            shuffledWrongAnswers.splice(randomPosition, 0, correctAnswer);
            
            return shuffledWrongAnswers;
        }

        // =============================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤...");
            loadQuestions();
        });

        // =============================================
        // –ó–ê–ì–†–£–ó–ö–ê –í–û–ü–†–û–°–û–í –ò–ó JSON
        // =============================================
        async function loadQuestions() {
            try {
                console.log("–ó–∞–≥—Ä—É–∂–∞—é –≤–æ–ø—Ä–æ—Å—ã —Å:", QUESTIONS_URL);
                
                const response = await fetch(QUESTIONS_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞: ${response.status}`);
                }
                
                const data = await response.json();
                console.log("–í–æ–ø—Ä–æ—Å—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:", data.length, "–≤–æ–ø—Ä–æ—Å–æ–≤");
                
                // –ü—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ–ø—Ä–æ—Å—ã –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                allQuestions = data;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞
                showClassSelection();
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:", error);
                showError(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã: ${error.message}`);
            }
        }

        function showClassSelection() {
            loadingElement.style.display = 'none';
            classSelection.style.display = 'grid';
            errorMessageElement.style.display = 'none';
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–ª–∞—Å—Å–æ–≤
            const classButtons = classSelection.querySelectorAll('button');
            classButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedClass = this.getAttribute('data-class');
                    console.log("–í—ã–±—Ä–∞–Ω –∫–ª–∞—Å—Å:", selectedClass);
                    startTest(selectedClass);
                });
            });
        }

        function showError(message) {
            loadingElement.style.display = 'none';
            classSelection.style.display = 'none';
            errorMessageElement.style.display = 'block';
            errorMessageElement.innerHTML = `
                ${message}<br><br>
                <button onclick="location.reload()" style="
                    background: #667eea;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 5px;
                    cursor: pointer;
                ">
                    üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                </button>
            `;
        }

        // =============================================
        // –ó–ê–ü–£–°–ö –¢–ï–°–¢–ê
        // =============================================
        function startTest(selectedClass) {
            console.log("–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –¥–ª—è –∫–ª–∞—Å—Å–∞:", selectedClass);
            
            currentClass = selectedClass;
            selectedClassSpan.textContent = `–ö–ª–∞—Å—Å: ${currentClass}`;
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–ª–∞—Å—Å—É (–ø—Ä–∏–≤–æ–¥–∏–º –∫ —á–∏—Å–ª—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
            filteredQuestions = allQuestions.filter(q => {
                const questionClass = typeof q.class === 'string' ? parseInt(q.class) : q.class;
                return questionClass == selectedClass; // –ù–µ—Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
            });
            
            console.log("–ù–∞–π–¥–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–ª–∞—Å—Å–∞", selectedClass, ":", filteredQuestions.length);
            
            if (filteredQuestions.length === 0) {
                alert(`–î–ª—è ${selectedClass} –∫–ª–∞—Å—Å–∞ –ø–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤.`);
                return;
            }

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
            filteredQuestions = shuffleArray(filteredQuestions);
            
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã
            filteredQuestions = filteredQuestions.map(question => {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
                const originalAnswers = question.answers || [];
                const originalCorrectIndex = originalAnswers.findIndex(a => a && a.isCorrect);
                
                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã
                const shuffledAnswers = shuffleAnswers(originalAnswers);
                
                // –ù–∞—Ö–æ–¥–∏–º –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è
                const correctAnswerText = originalCorrectIndex !== -1 ? originalAnswers[originalCorrectIndex].text : '';
                const newCorrectIndex = shuffledAnswers.findIndex(a => a && a.text === correctAnswerText);
                
                return {
                    ...question,
                    answers: shuffledAnswers,
                    originalCorrectIndex: originalCorrectIndex,
                    newCorrectIndex: newCorrectIndex
                };
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ—Å—Ç
            initializeQuiz();
        }

        function initializeQuiz() {
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            currentQuestionIndex = 0;
            userAnswers = new Array(filteredQuestions.length).fill(null);
            score = 0;
            reportContainer.innerHTML = '';
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
            startScreen.style.display = 'none';
            resultsScreen.style.display = 'none';
            quizContainer.style.display = 'block';

            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
            finishButton.style.display = 'none';
            finishAnytimeButton.style.display = 'block';
            nextButton.style.display = 'inline-block';
            nextButton.disabled = true;
            prevButton.disabled = true;

            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            if (!prevButton.onclick) {
                prevButton.addEventListener('click', goToPreviousQuestion);
            }
            if (!nextButton.onclick) {
                nextButton.addEventListener('click', goToNextQuestion);
            }
            if (!finishButton.onclick) {
                finishButton.addEventListener('click', finishTest);
            }
            if (!finishAnytimeButton.onclick) {
                finishAnytimeButton.addEventListener('click', finishTestAnytime);
            }
            if (!restartButton.onclick) {
                restartButton.addEventListener('click', restartTest);
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
            renderQuestion(currentQuestionIndex);
            renderNavigation();
        }

        // =============================================
        // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –í–û–ü–†–û–°–û–í
        // =============================================
        function renderQuestion(index) {
            if (index < 0 || index >= filteredQuestions.length) return;
            
            const question = filteredQuestions[index];
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (–±–µ–∑ —Ç–µ–º—ã)
            questionText.innerHTML = `<div><strong>–í–æ–ø—Ä–æ—Å ${index + 1}.</strong> ${question.question || '–í–æ–ø—Ä–æ—Å –±–µ–∑ —Ç–µ–∫—Å—Ç–∞'}</div>`;
            
            // –û—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            answersArea.innerHTML = '';
            
            if (question.answers && question.answers.length > 0) {
                question.answers.forEach((answer, optionIndex) => {
                    if (!answer || !answer.text) return;
                    
                    const button = document.createElement('button');
                    button.className = 'answer-option';
                    button.textContent = `${String.fromCharCode(65 + optionIndex)}) ${answer.text}`; // A), B), C), D)
                    
                    if (userAnswers[index] === optionIndex) {
                        button.classList.add('selected');
                    }
                    
                    button.addEventListener('click', function() {
                        selectAnswer(optionIndex);
                    });
                    
                    answersArea.appendChild(button);
                });
            } else {
                answersArea.innerHTML = '<p style="color: #e74c3c; text-align: center;">–ù–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞</p>';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            progressCounter.textContent = `–í–æ–ø—Ä–æ—Å ${index + 1} –∏–∑ ${filteredQuestions.length}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∏ –∫–Ω–æ–ø–∫–∏
            renderNavigation();
            updateButtonVisibility();
        }

        function selectAnswer(optionIndex) {
            console.log("–í—ã–±—Ä–∞–Ω –æ—Ç–≤–µ—Ç:", optionIndex, "–¥–ª—è –≤–æ–ø—Ä–æ—Å–∞", currentQuestionIndex);
            userAnswers[currentQuestionIndex] = optionIndex;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫
            const buttons = answersArea.querySelectorAll('.answer-option');
            buttons.forEach((btn, idx) => {
                btn.classList.toggle('selected', idx === optionIndex);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∏ –∫–Ω–æ–ø–∫–∏
            renderNavigation();
            updateButtonVisibility();
        }

        function renderNavigation() {
            navigationPanel.innerHTML = '';
            
            filteredQuestions.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = 'nav-dot';
                dot.textContent = index + 1;
                
                if (index === currentQuestionIndex) {
                    dot.classList.add('active');
                }
                
                if (userAnswers[index] !== null) {
                    dot.classList.add('answered');
                }
                
                dot.addEventListener('click', function() {
                    if (index >= 0 && index < filteredQuestions.length) {
                        currentQuestionIndex = index;
                        renderQuestion(currentQuestionIndex);
                        updateButtonVisibility();
                    }
                });
                
                navigationPanel.appendChild(dot);
            });
        }

        // =============================================
        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        // =============================================
        function updateButtonVisibility() {
            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
            prevButton.disabled = currentQuestionIndex === 0;
            
            // –ö–Ω–æ–ø–∫–∏ "–î–∞–ª–µ–µ" –∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
            const hasAnswer = userAnswers[currentQuestionIndex] !== null;
            const isLastQuestion = currentQuestionIndex === filteredQuestions.length - 1;
            
            if (!isLastQuestion) {
                nextButton.disabled = !hasAnswer;
                nextButton.style.display = 'inline-block';
                finishButton.style.display = 'none';
                finishAnytimeButton.style.display = 'block';
            } else {
                nextButton.style.display = 'none';
                finishButton.style.display = 'inline-block';
                finishButton.disabled = !hasAnswer;
                finishAnytimeButton.style.display = 'none';
            }
        }

        function goToPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
            }
        }

        function goToNextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—Ç–≤–µ—Ç
                if (userAnswers[currentQuestionIndex] === null) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å');
                    return;
                }
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            }
        }

        // =============================================
        // –ó–ê–í–ï–†–®–ï–ù–ò–ï –¢–ï–°–¢–ê
        // =============================================
        function finishTestAnytime() {
            // –°—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ—Å—Ç
            finishTest();
        }

        function finishTest() {
            // –°—Ä–∞–∑—É —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            calculateResults();
        }

        function calculateResults() {
            score = 0;
            reportContainer.innerHTML = '';
            
            filteredQuestions.forEach((question, index) => {
                const userAnswerIndex = userAnswers[index];
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è
                const correctAnswerIndex = question.newCorrectIndex !== undefined ? question.newCorrectIndex : -1;
                
                if (correctAnswerIndex === -1) {
                    console.warn(`–í–æ–ø—Ä–æ—Å ${index + 1} –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞`);
                    return;
                }
                
                const isCorrect = userAnswerIndex !== null && userAnswerIndex === correctAnswerIndex;
                
                if (isCorrect) {
                    score++;
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result-item';
                    
                    let userAnswerText = '–ù–µ –æ—Ç–≤–µ—á–µ–Ω–æ';
                    if (userAnswerIndex !== null && question.answers && question.answers[userAnswerIndex]) {
                        userAnswerText = question.answers[userAnswerIndex].text;
                    }
                    
                    const correctAnswerText = question.answers && question.answers[correctAnswerIndex] 
                        ? question.answers[correctAnswerIndex].text 
                        : '–ù–µ —É–∫–∞–∑–∞–Ω';
                    
                    resultDiv.innerHTML = `
                        <div style="margin-bottom: 10px;">
                            <strong>–í–æ–ø—Ä–æ—Å ${index + 1}:</strong> ${question.question || '–í–æ–ø—Ä–æ—Å –±–µ–∑ —Ç–µ–∫—Å—Ç–∞'}
                        </div>
                        <div style="color: #ef4444; margin-bottom: 5px;">
                            <strong>–í–∞—à –æ—Ç–≤–µ—Ç:</strong> ${userAnswerText}
                        </div>
                        <div style="color: #10b981; font-weight: bold;">
                            <strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong> ${correctAnswerText}
                        </div>
                    `;
                    
                    reportContainer.appendChild(resultDiv);
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            showResults();
        }

        function showResults() {
            quizContainer.style.display = 'none';
            resultsScreen.style.display = 'block';
            
            scoreSpan.textContent = `${score} –∏–∑ ${filteredQuestions.length}`;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const percentage = filteredQuestions.length > 0 ? Math.round((score / filteredQuestions.length) * 100) : 0;
            let message = '';
            
            if (percentage >= 90) {
                message = 'üéâ –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!';
            } else if (percentage >= 70) {
                message = 'üëç –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!';
            } else if (percentage >= 50) {
                message = 'üìö –ù–µ–ø–ª–æ—Ö–æ, –Ω–æ –µ—Å—Ç—å —á—Ç–æ –ø–æ–¥—É—á–∏—Ç—å!';
            } else {
                message = 'üìñ –ù—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª!';
            }
            
            // –ï—Å–ª–∏ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏
            if (reportContainer.children.length === 0) {
                reportContainer.innerHTML = `
                    <div style="background: #e8f5e9; padding: 30px; border-radius: 10px; margin: 20px 0;">
                        <p style="font-size: 1.2em; color: #10b981; font-weight: bold;">${message}</p>
                        <p style="font-size: 1.1em; margin-top: 10px;">–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã!</p>
                        <p style="color: #666; margin-top: 10px;">–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: <strong>${percentage}%</strong></p>
                    </div>
                `;
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –Ω–∞—á–∞–ª–æ –æ—Ç—á–µ—Ç–∞
                const statsHTML = `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="font-size: 1.2em; color: #667eea; font-weight: bold;">${message}</p>
                        <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                            <div>
                                <p style="color: #10b981; font-size: 1.5em; font-weight: bold; margin: 0;">${score}</p>
                                <p style="color: #666; margin: 0;">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</p>
                            </div>
                            <div>
                                <p style="color: #ef4444; font-size: 1.5em; font-weight: bold; margin: 0;">${filteredQuestions.length - score}</p>
                                <p style="color: #666; margin: 0;">–û—à–∏–±–æ–∫</p>
                            </div>
                            <div>
                                <p style="color: #667eea; font-size: 1.5em; font-weight: bold; margin: 0;">${percentage}%</p>
                                <p style="color: #666; margin: 0;">–£—Å–ø–µ—Ö</p>
                            </div>
                        </div>
                    </div>
                `;
                reportContainer.insertAdjacentHTML('afterbegin', statsHTML);
            }
        }

        // =============================================
        // –ü–ï–†–ï–ó–ê–ü–£–°–ö –¢–ï–°–¢–ê
        // =============================================
        function restartTest() {
            resultsScreen.style.display = 'none';
            startScreen.style.display = 'block';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            currentClass = null;
            filteredQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            score = 0;
            reportContainer.innerHTML = '';
            
            selectedClassSpan.textContent = '';
        }

        // =============================================
        // –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò
        // =============================================
        document.addEventListener('keydown', function(e) {
            if (quizContainer.style.display !== 'block') return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    if (!prevButton.disabled) prevButton.click();
                    break;
                case 'ArrowRight':
                    if (!nextButton.disabled && nextButton.style.display !== 'none') nextButton.click();
                    break;
                case 'Enter':
                    if (finishButton.style.display !== 'none' && !finishButton.disabled) {
                        finishButton.click();
                    } else if (finishAnytimeButton.style.display !== 'none') {
                        finishAnytimeButton.click();
                    }
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    const keyNum = parseInt(e.key) - 1;
                    const buttons = answersArea.querySelectorAll('.answer-option');
                    if (buttons[keyNum]) {
                        buttons[keyNum].click();
                    }
                    break;
            }
        });

        // =============================================
        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –û–¢–õ–ê–î–ö–ò
        // =============================================
        window.debugApp = {
            loadQuestions: loadQuestions,
            getState: () => ({
                allQuestions: allQuestions,
                currentClass: currentClass,
                filteredQuestions: filteredQuestions,
                currentQuestionIndex: currentQuestionIndex,
                userAnswers: userAnswers,
                score: score
            }),
            showClassSelection: showClassSelection,
            startTest: startTest
        };
    </script>
</body>
</html>
